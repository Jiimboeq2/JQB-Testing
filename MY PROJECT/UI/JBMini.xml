<?xml version="1.0" encoding="UTF-8" ?>
<ISUI>
    <!-- Mini Control Window -->
    <Window Name='JB_Mini_Window' Template='Window'>
        <X>20</X>
        <Y>20</Y>
        <Width>140</Width>
        <Height>180</Height>
        <Client Template="Window.Client" />
        <StorePosition>1</StorePosition>
        <Visible>1</Visible>
        <Title>JB Control</Title>
        <OnLoad>
            declarevariable JBUI_Mini_Window int global ${This.ID}
            declarevariable _bJB_Active bool global
            declarevariable _bJB_Paused bool global
            declarevariable JB_ScriptName string global
            _bJB_Active:Set[FALSE]
            _bJB_Paused:Set[FALSE]
        </OnLoad>
        <OnUnLoad>
            ui -unload "${PATH_UI}/JBMain.xml"
            if ${Script[JInstanceRunner](exists)}
                endscript JInstanceRunner
            if ${Script[JQuestBot](exists)}
                endscript JQuestBot
        </OnUnLoad>
        <TitleBar Template="Window.TitleBar">
            <X>0</X>
            <Y>0</Y>
            <Width>100%</Width>
            <Height>18</Height>
            <Children>
                <Text Name="Title" Template="Window.TitleBar.Title">
                    <Alignment>Left</Alignment>
                </Text>
                <CommandButton Name="Custom Quit Button" Template="Window.TitleBar.Close">
                    <X>r16</X>
                    <Y>0</Y>
                    <Width>13</Width>
                    <Height>13</Height>
                    <OnLeftClick>
                        ui -unload "${PATH_UI}/JBMini.xml"
                        ui -unload "${PATH_UI}/JBMain.xml"
                        if ${Script[JInstanceRunner](exists)}
                            endscript JInstanceRunner
                        if ${Script[JQuestBot](exists)}
                            endscript JQuestBot
                    </OnLeftClick>
                </CommandButton>
            </Children>
        </TitleBar>
        <Children>
            <!-- Start Button -->
            <CommandButton Name="Start_Button">
                <X>10</X>
                <Y>10</Y>
                <Width>120</Width>
                <Height>25</Height>
                <Text>Start Instance</Text>
                <Font>
                    <Bold>1</Bold>
                </Font>
                <OnLeftClick>
                    if ${_sJB_SelectedInstance.Length}
                    {
                        UIElement[${JBUI_Stop_Button}]:Show
                        relay ${OgreRelayGroup} "_bJB_Active:Set[TRUE]"
                        
                        if ${JB_DeveloperMode}
                            runscript "JB/JInstanceRunner" "${_sJB_SelectedInstance}"
                        else
                            run JInstanceRunner "${_sJB_SelectedInstance}"
                        
                        UIElement[${JBUI_Start_Button}]:Hide
                    }
                    else
                    {
                        echo ${Time}: ERROR: No instance selected!
                        echo ${Time}: Open Main UI and select an instance first
                    }
                </OnLeftClick>
                <OnLoad>
                    declarevariable JBUI_Start_Button int global ${This.ID}
                    declarevariable _sJB_SelectedInstance string global
                    declarevariable JB_DeveloperMode bool global
                    JB_DeveloperMode:Set[FALSE]
                    UIElement[${JBUI_Start_Button}].Font:SetColor[FF00FF00]
                </OnLoad>
            </CommandButton>
            
            <!-- Stop Button -->
            <CommandButton Name="Stop_Button">
                <X>10</X>
                <Y>10</Y>
                <Width>120</Width>
                <Height>25</Height>
                <Visible>0</Visible>
                <Text>Stop</Text>
                <Font>
                    <Bold>1</Bold>
                </Font>
                <OnLeftClick>
                    if ${Script[JInstanceRunner](exists)}
                        Script[JInstanceRunner]:ExecuteAtom[a_Instance_Stop]
                    if ${Script[JQuestBot](exists)}
                        Script[JQuestBot]:ExecuteAtom[a_QuestBot_Stop]
                    
                    UIElement[${JBUI_Start_Button}]:Show
                    UIElement[${JBUI_Resume_Button}]:Hide
                    This:Hide
                </OnLeftClick>
                <OnLoad>
                    declarevariable JBUI_Stop_Button int global ${This.ID}
                    UIElement[${JBUI_Stop_Button}].Font:SetColor[FFFF0000]
                </OnLoad>
            </CommandButton>
            
            <!-- Pause Button -->
            <CommandButton Name="Pause_Button">
                <X>10</X>
                <Y>40</Y>
                <Width>120</Width>
                <Height>25</Height>
                <Text>Pause</Text>
                <OnLeftClick>
                    if ${_bJB_Active}
                    {
                        _bJB_Paused:Set[TRUE]
                        
                        if ${Script[JInstanceRunner](exists)}
                            Script[JInstanceRunner]:ExecuteAtom[a_Instance_Pause]
                        if ${Script[JQuestBot](exists)}
                            Script[JQuestBot]:ExecuteAtom[a_QuestBot_Pause]
                        
                        UIElement[${JBUI_Resume_Button}]:Show
                        This:Hide
                    }
                </OnLeftClick>
                <OnLoad>
                    declarevariable JBUI_Pause_Button int global ${This.ID}
                </OnLoad>
            </CommandButton>
            
            <!-- Resume Button -->
            <CommandButton Name="Resume_Button">
                <X>10</X>
                <Y>40</Y>
                <Width>120</Width>
                <Height>25</Height>
                <Visible>0</Visible>
                <Text>Resume</Text>
                <OnLeftClick>
                    _bJB_Paused:Set[FALSE]
                    
                    if ${Script[JInstanceRunner](exists)}
                        Script[JInstanceRunner]:ExecuteAtom[a_Instance_Resume]
                    if ${Script[JQuestBot](exists)}
                        Script[JQuestBot]:ExecuteAtom[a_QuestBot_Resume]
                    
                    UIElement[${JBUI_Pause_Button}]:Show
                    This:Hide
                </OnLeftClick>
                <OnLoad>
                    declarevariable JBUI_Resume_Button int global ${This.ID}
                </OnLoad>
            </CommandButton>
            
            <!-- Next Step Button -->
            <CommandButton Name="NextStep_Button">
                <X>10</X>
                <Y>70</Y>
                <Width>120</Width>
                <Height>20</Height>
                <Text>Skip Step</Text>
                <OnLeftClick>
                    if ${Script[JInstanceRunner](exists)}
                    {
                        ; Increment step counter
                        J_Instance_CurrentStep:Inc
                        echo ${Time}: [Manual] Skipping to step ${J_Instance_CurrentStep}
                    }
                </OnLeftClick>
                <OnLoad>
                    declarevariable JBUI_NextStep_Button int global ${This.ID}
                </OnLoad>
            </CommandButton>
            
            <!-- Quick Task Button -->
            <CommandButton Name="QuickTask_Button">
                <X>10</X>
                <Y>95</Y>
                <Width>120</Width>
                <Height>20</Height>
                <Text>Run Quick Task</Text>
                <OnLeftClick>
                    if ${_sJB_SelectedTask.Length}
                    {
                        if ${JB_DeveloperMode}
                            runscript "Eq2JCommon/JQuestBot/JQuestBot" "${_sJB_SelectedTask}"
                        else
                            run JQuestBot "${_sJB_SelectedTask}"
                    }
                    else
                    {
                        echo ${Time}: ERROR: No task selected!
                    }
                </OnLeftClick>
                <OnLoad>
                    declarevariable JBUI_QuickTask_Button int global ${This.ID}
                    declarevariable _sJB_SelectedTask string global
                </OnLoad>
            </CommandButton>
            
            <!-- Show Main Button -->
            <CommandButton Name="ShowMain_Button">
                <X>10</X>
                <Y>120</Y>
                <Width>120</Width>
                <Height>20</Height>
                <Text>Show Main</Text>
                <OnLeftClick>
                    UIElement[${JBUI_Main_Window}]:Show
                    UIElement[${JBUI_HideMain_Button}]:Show
                    This:Hide
                </OnLeftClick>
                <OnLoad>
                    declarevariable JBUI_ShowMain_Button int global ${This.ID}
                </OnLoad>
            </CommandButton>
            
            <!-- Hide Main Button -->
            <CommandButton Name="HideMain_Button">
                <X>10</X>
                <Y>120</Y>
                <Width>120</Width>
                <Height>20</Height>
                <Visible>0</Visible>
                <Text>Hide Main</Text>
                <OnLeftClick>
                    UIElement[${JBUI_Main_Window}]:Hide
                    UIElement[${JBUI_ShowMain_Button}]:Show
                    This:Hide
                </OnLeftClick>
                <OnLoad>
                    declarevariable JBUI_HideMain_Button int global ${This.ID}
                </OnLoad>
            </CommandButton>
            
            <!-- Status Display -->
            <Text name='Status_Text'>
                <X>10</X>
                <Y>145</Y>
                <Width>120</Width>
                <Height>30</Height>
                <Alignment>Center</Alignment>
                <Wrap>1</Wrap>
                <Font>
                    <Size>10</Size>
                </Font>
                <Text>Ready</Text>
                <OnLoad>
                    declarevariable JBUI_Status_Text int global ${This.ID}
                    UIElement[${JBUI_Status_Text}].Font:SetColor[FFFFFF00]
                </OnLoad>
            </Text>
        </Children>
    </Window>
</ISUI>